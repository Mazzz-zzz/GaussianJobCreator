# Orbital Visualization from ADMP Calculations

This directory contains scripts to generate cube files for visualizing molecular orbitals from ADMP calculations.

## Overview

The ADMP (Atom-centered Density Matrix Propagation) method in Gaussian produces checkpoint files that contain valuable information about the electronic structure of molecules during dynamics. This tool helps extract and visualize the molecular orbitals (particularly HOMO and LUMO) from these checkpoint files.

## Contents

- `generate_inputs.py`: Python script that finds formatted checkpoint files and creates a SLURM submission script
- `submit_orbital_generation.s`: SLURM script (generated by Python) that runs cubegen directly on all checkpoint files

## How It Works

This script follows the approach described in section 7.7 of the VMD documentation for "Volumetric data from Gaussian" and uses the Gaussian `cubegen` utility:

1. It locates all formatted checkpoint files (.fchk) from ADMP calculations
2. Generates a single SLURM batch script that processes all files
3. The SLURM job processes each checkpoint file with the `cubegen` utility
4. The `cubegen` utility directly generates cube files for HOMO, LUMO, or other specified orbitals

The approach is similar to how the ADMP jobs are submitted via the `submit_admp_jobs.s` script, providing a consistent workflow.

## Prerequisites

- Python 3.6+
- Gaussian 16 installed and accessible via the module system (particularly the `cubegen` utility)
- Formatted checkpoint files (`.fchk`) from ADMP calculations

## Directory Structure

The script expects the following directory structure for finding checkpoint files:

```
ADMP_decomposition_gaussian/
└── admp_jobs/
    └── results/
        └── molecule_name/
            └── temperature/
                └── checkpoints/
                    └── molecule_ADMP.fchk
```

## Usage

### Generating the SLURM Submission Script

Run the Python script to generate the SLURM submission script:

```bash
cd generate_orbitals_from_ADMP
python generate_inputs.py
```

This will create `submit_orbital_generation.s`, a fully configured SLURM script.

### Submitting the Job to the Cluster

Submit the generated script to your SLURM cluster:

```bash
sbatch submit_orbital_generation.s
```

The script will:
1. Process all formatted checkpoint files
2. Generate cube files for the specified orbitals
3. Organize output by molecule and temperature
4. Provide detailed progress and error reporting

### Output

The cube files will be created in the `cube_files` directory, organized as:

```
cube_files/
└── molecule_name/
    └── temperature/
        ├── homo_checkpointname.cube
        └── lumo_checkpointname.cube
```

## Customization

You can customize the script behavior with command-line arguments:

```bash
python generate_inputs.py --help
```

Options include:

- `--base-dir`: Change the base directory containing ADMP results (default: "../ADMP_decomposition_gaussian/admp_jobs/results")
- `--output-dir`: Change where cube files will be stored (default: "./cube_files")
- `--grid-size`: Adjust the resolution of the cube grid (default: 80)
- `--orbitals`: Specify which orbitals to extract (e.g., `--orbitals HOMO LUMO HOMO-1 LUMO+1`)
- `--max-time`: Set the maximum time for the SLURM job (default: "12:00:00")

## Troubleshooting

If no checkpoint files are found:

1. Verify that the path to your results directory is correct
2. Check that your ADMP calculations completed successfully
3. Ensure that formatted checkpoint files (.fchk) have been created
4. Run with verbose output: `python -v generate_inputs.py`

If the SLURM job fails:

1. Check the SLURM output log (ADMP_orbitals_*.log)
2. Verify that the Gaussian module is loaded correctly
3. Ensure the cubegen utility is available in your environment

## Visualization with VMD

The generated cube files can be visualized using VMD (Visual Molecular Dynamics) by following these steps:

1. Load your molecule structure in VMD
2. Use the "Graphics → Representations" menu
3. Click "Create Rep"
4. Set "Drawing Method" to "Isosurface"
5. For HOMO/LUMO visualization, create two representations:
   - One with positive isovalue (e.g., 0.05)
   - One with negative isovalue (e.g., -0.05)
   - Use different colors for each (e.g., blue for positive, red for negative)

Other molecular visualization software can also be used:
- Chimera
- GaussView
- PyMOL

## Creating Orbital Animations

Once you have cube files for each frame, you can create an animation:

1. Load all frames into VMD
2. Set consistent isovalues for all frames (e.g., +0.05 and -0.05)
3. Use consistent coloring (e.g., blue for positive, red for negative lobes)
4. Render each frame and combine into an animation using tools like:
   - ffmpeg: `ffmpeg -framerate 10 -pattern_type glob -i '*.png' -c:v libx264 orbital_animation.mp4`
   - ImageMagick: `convert -delay 10 -loop 0 *.png animation.gif` 